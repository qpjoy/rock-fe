<body>
  <input type="file" />
  <img class="preview" />
  <button>生成截图后的File对象</button>
  <script>
    const inpFile = document.querySelector('input[type="file"]');
    const img = document.querySelector(".preview");
    const btn = document.querySelector("button");

    inpFile.onchange = (e) => {
      const file = e.target.files[0];
      console.log(file);
      const reader = new FileReader();
      reader.onload = (e) => {
        console.log(e.target.result);
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    };

    btn.onclick = () => {
      const cutInfo = {
        x: 500,
        y: 500,
        cutWidth: 300,
        cutHeight: 300,
        width: 100,
        height: 100,
      };
      const canvas = document.createElement("canvas");
      canvas.width = cutInfo.width;
      canvas.height = cutInfo.height;
      const ctx = canvas.getContext("2d");
      console.log(`[Img]: `, img);

      //   // 按比例缩放
      //   ctx.drawImage(
      //     img,
      //     0,
      //     0,
      //     img.width,
      //     img.height, // source rectangle
      //     0,
      //     0,
      //     canvas.width,
      //     canvas.height
      //   );

      ctx.drawImage(
        img,
        50,
        100,
        cutInfo.cutWidth,
        cutInfo.cutHeight,
        0,
        0,
        cutInfo.width,
        cutInfo.height
      );

      //   canvas.toBlob((blob) => {
      //     console.log(blob);
      //     const file = new File([blob], "avatar.jpg", {
      //       type: "image/jpeg",
      //     });
      //     console.log(file);
      //   }, "image/jpeg");

      document.body.appendChild(canvas);
    };
  </script>

  <script>
    function drawImageProp(ctx, img, x, y, w, h, offsetX, offsetY) {
      if (arguments.length === 2) {
        x = y = 0;
        w = ctx.canvas.width;
        h = ctx.canvas.height;
      }

      // default offset is center
      offsetX = typeof offsetX === "number" ? offsetX : 0.5;
      offsetY = typeof offsetY === "number" ? offsetY : 0.5;

      // keep bounds [0.0, 1.0]
      if (offsetX < 0) offsetX = 0;
      if (offsetY < 0) offsetY = 0;
      if (offsetX > 1) offsetX = 1;
      if (offsetY > 1) offsetY = 1;

      var iw = img.width,
        ih = img.height,
        r = Math.min(w / iw, h / ih),
        nw = iw * r, // new prop. width
        nh = ih * r, // new prop. height
        cx,
        cy,
        cw,
        ch,
        ar = 1;

      // decide which gap to fill
      if (nw < w) ar = w / nw;
      if (Math.abs(ar - 1) < 1e-14 && nh < h) ar = h / nh; // updated
      nw *= ar;
      nh *= ar;

      // calc source rectangle
      cw = iw / (nw / w);
      ch = ih / (nh / h);

      cx = (iw - cw) * offsetX;
      cy = (ih - ch) * offsetY;

      // make sure source rectangle is valid
      if (cx < 0) cx = 0;
      if (cy < 0) cy = 0;
      if (cw > iw) cw = iw;
      if (ch > ih) ch = ih;

      // fill image in dest. rectangle
      ctx.drawImage(img, cx, cy, cw, ch, x, y, w, h);
    }
  </script>
</body>
